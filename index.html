<!DOCTYPE html>
<html lang="zh-TW" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>A Couple Minutes - Fixed</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&family=Noto+Sans+TC:wght@300;400;500;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: { light: '#FFF0F3', DEFAULT: '#FFCCD5', dark: '#C9184A', text: '#590D22' },
                        dark: { bg: '#121212', surface: '#1E1E1E', text: '#E5E5E5' }
                    },
                    fontFamily: { serif: ['"Playfair Display"', '"Noto Serif TC"', 'serif'], sans: ['"Noto Sans TC"', 'sans-serif'] },
                    boxShadow: { 'card': '0 20px 60px -15px rgba(89, 13, 34, 0.2)' },
                    animation: { 'float': 'float 3s ease-in-out infinite', 'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both' },
                    keyframes: {
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } },
                        shake: { '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' }, '20%, 80%': { transform: 'translate3d(2px, 0, 0)' }, '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' }, '40%, 60%': { transform: 'translate3d(4px, 0, 0)' } }
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; overflow: hidden; -webkit-tap-highlight-color: transparent; user-select: none; transition: background 0.5s ease; }
        body:not(.dark) { background: linear-gradient(135deg, #FFF0F3 0%, #FFF5F7 50%, #FFCCD5 100%); }
        body.dark { background: linear-gradient(135deg, #121212 0%, #1a1a1a 50%, #2d1b20 100%); color: #E5E5E5; }
        .glass { background: rgba(255, 255, 255, 0.65); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.4); }
        .dark .glass { background: rgba(45, 45, 45, 0.6); border: 1px solid rgba(255, 255, 255, 0.1); color: white; }
        .blur-reveal { filter: blur(16px); transform: scale(0.95); transition: all 0.6s ease; }
        .blur-reveal.revealed { filter: blur(0); transform: scale(1); }
        .hazard-stripe { background: repeating-linear-gradient(45deg, #FBBF24, #FBBF24 10px, #000 10px, #000 20px); }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        .slide-up-enter-active { transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .slide-up-enter-from { transform: translateY(100px) scale(0.9); opacity: 0; }
    </style>
</head>
<body>

<div id="app" class="h-screen w-full flex flex-col relative overflow-hidden transition-colors duration-500">
    
    <div class="absolute top-0 left-0 w-full z-50 p-4 flex justify-between items-center">
        <div class="flex items-center gap-2" @click="resetGame">
            <span class="font-serif font-bold tracking-widest text-xl cursor-pointer text-brand-text dark:text-white">C/M</span>
        </div>
        <div class="flex gap-3">
            <button @click="toggleDarkMode" class="p-2 rounded-full glass hover:bg-white/40 transition text-brand-text dark:text-white">
                {{ isDark ? 'üåô' : '‚òÄÔ∏è' }}
            </button>
            <button @click="showSettings = true" class="p-2 rounded-full glass hover:bg-white/40 transition text-brand-text dark:text-white">
                ‚öôÔ∏è
            </button>
        </div>
    </div>

    <div v-if="showSettings" class="absolute inset-0 z-[60] bg-black/50 backdrop-blur-sm flex justify-end">
        <div class="w-4/5 md:w-1/3 h-full bg-white dark:bg-dark-surface shadow-2xl p-6 flex flex-col overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold dark:text-white">Settings</h2>
                <button @click="showSettings = false" class="text-2xl dark:text-white">&times;</button>
            </div>
            
            <div class="mb-6">
                <h3 class="text-sm font-bold opacity-50 mb-3 uppercase dark:text-gray-400">Language</h3>
                <div class="flex gap-2">
                    <button v-for="lang in ['zh-TW', 'en']" @click="currentLang = lang"
                        class="px-3 py-1 rounded-lg text-sm border transition dark:text-white"
                        :class="currentLang === lang ? 'bg-brand-dark text-white' : 'border-gray-300'">
                        {{ lang === 'en' ? 'English' : 'ÁπÅÈ´î‰∏≠Êñá' }}
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="w-full max-w-md mx-auto h-full flex flex-col relative z-10 px-6 pt-16 pb-6">

        <transition name="fade" mode="out-in">
            <div v-if="gameState === 'intro'" class="flex-1 flex flex-col justify-center space-y-5" key="intro">
                <div class="text-center space-y-2 mb-2">
                    <h2 class="text-4xl font-serif font-bold dark:text-white">A Couple Minutes</h2>
                    <p class="opacity-60 text-sm dark:text-gray-400">{{ t('subtitle') }}</p>
                </div>

                <div class="space-y-3 overflow-y-auto pb-4 px-1">
                    <div v-for="(mode, key) in modes" :key="key" 
                        @click="startGame(key)"
                        class="glass p-5 rounded-2xl flex items-center gap-4 cursor-pointer transform transition hover:scale-[1.02] active:scale-95 shadow-sm border-l-4"
                        :class="mode.borderColor">
                        <div class="text-2xl w-10 h-10 rounded-full flex items-center justify-center" :class="mode.iconBg">{{ mode.emoji }}</div>
                        <div class="flex-1">
                            <h3 class="font-bold dark:text-white">{{ t(mode.titleKey) }}</h3>
                            <p class="text-xs opacity-60 dark:text-gray-400">{{ t(mode.descKey) }}</p>
                        </div>
                        <div v-if="progress[key]" class="text-green-500">‚úì</div>
                    </div>
                </div>
            </div>

            <div v-else-if="gameState === 'selection'" class="flex-1 flex flex-col justify-center items-center gap-6" key="selection">
                <div class="text-center mb-4">
                    <div class="glass px-4 py-1 rounded-full text-xs font-bold inline-block mb-4 dark:text-white">
                        {{ t('turn') }}: <span class="text-brand-dark dark:text-brand-accent text-lg">{{ currentPlayer }}</span>
                    </div>
                    <h3 class="text-2xl font-serif font-bold dark:text-white">{{ t('chooseDestiny') }}</h3>
                </div>
                <button @click="pickTodCard('truth')" class="w-full py-8 bg-blue-50 border-2 border-blue-200 rounded-3xl flex items-center px-6 gap-4 shadow-sm hover:bg-blue-100 transition group relative overflow-hidden">
                    <div class="text-4xl">üíô</div>
                    <div class="text-left z-10">
                        <div class="text-2xl font-bold text-blue-600">{{ t('truth') }}</div>
                        <div class="text-xs text-blue-400">TRUTH</div>
                    </div>
                </button>
                <button @click="pickTodCard('dare')" class="w-full py-8 bg-orange-50 border-2 border-orange-200 rounded-3xl flex items-center px-6 gap-4 shadow-sm hover:bg-orange-100 transition group relative overflow-hidden">
                    <div class="text-4xl">üî•</div>
                    <div class="text-left z-10">
                        <div class="text-2xl font-bold text-orange-600">{{ t('dare') }}</div>
                        <div class="text-xs text-orange-400">DARE</div>
                    </div>
                </button>
                <button @click="resetGame" class="mt-8 text-sm opacity-50 dark:text-white">{{ t('back') }}</button>
            </div>

            <div v-else-if="gameState === 'game'" class="flex-1 flex flex-col relative pb-4" key="game">
                <div v-if="currentCategory !== 'tod'" class="flex justify-center mb-4">
                    <div class="glass px-4 py-1 rounded-full text-xs font-bold tracking-wider dark:text-white">
                        {{ t('turn') }}: {{ currentPlayer }}
                    </div>
                </div>

                <div class="flex-1 flex items-center justify-center perspective-1000 relative z-20">
                    <transition name="slide-up" mode="out-in">
                        <div :key="currentCard.id" 
                             @click="revealCard"
                             class="w-full aspect-[3/4] max-h-[500px] rounded-[32px] shadow-card p-8 flex flex-col relative overflow-hidden cursor-pointer transition-colors duration-500 bg-white dark:bg-dark-surface border dark:border-gray-700"
                             :class="cardBorderClass">
                            
                            <div v-if="!isRevealed" class="absolute inset-0 z-30 flex flex-col items-center justify-center bg-white/10 backdrop-blur-md">
                                <span class="text-4xl animate-float mb-2">üëÜ</span>
                                <p class="text-sm font-bold tracking-widest uppercase opacity-60 dark:text-white">Tap to Reveal</p>
                            </div>
                            
                            <div class="flex-1 flex flex-col justify-center items-center text-center transition-all duration-700"
                                 :class="{ 'blur-reveal': true, 'revealed': isRevealed }">
                                
                                <span v-if="currentCard.type === 'action' || currentCard.subType === 'dare'" class="mb-4 px-3 py-1 bg-yellow-400 text-yellow-900 text-xs font-bold rounded-full">DARE / ACTION</span>
                                <span v-if="currentCard.subType === 'truth'" class="mb-4 px-3 py-1 bg-blue-100 text-blue-600 text-xs font-bold rounded-full">TRUTH</span>

                                <h3 class="font-serif font-medium leading-relaxed text-2xl md:text-3xl dark:text-white">
                                    {{ displayContent(currentCard.text) }}
                                </h3>

                                <div v-if="currentCard.time && isRevealed" class="mt-8">
                                    <button @click.stop="toggleTimer" class="px-6 py-2 rounded-full border border-current opacity-70 font-mono text-xl flex items-center gap-2 dark:text-white">
                                        <span v-if="!timerRunning">‚ñ∂ {{ currentCard.time }}s</span>
                                        <span v-else class="text-red-500 font-bold">{{ timerCount }}s</span>
                                    </button>
                                </div>
                            </div>

                            <div class="mt-auto flex justify-between items-end opacity-30 dark:text-gray-400">
                                <span class="text-[10px] uppercase">{{ currentCategory === 'tod' ? 'Truth or Dare' : t('question') }}</span>
                            </div>
                        </div>
                    </transition>
                </div>

                <div class="mt-6 flex flex-col gap-3 z-30">
                    <div class="flex gap-3">
                        <button @click="sendReaction" class="w-14 h-14 rounded-2xl bg-white dark:bg-dark-surface shadow-soft flex items-center justify-center text-2xl active:scale-90 transition">‚ù§Ô∏è</button>
                        <button @click="nextCard" :disabled="!isRevealed" 
                                class="flex-1 h-14 rounded-2xl bg-brand-dark text-white font-bold shadow-soft flex justify-center items-center active:scale-95 disabled:opacity-50 transition">
                            {{ isLastCard && currentCategory !== 'tod' ? t('finish') : t('next') }}
                        </button>
                    </div>
                    
                    <button v-if="isRevealed" @click="triggerPunishment" class="text-xs text-gray-400 dark:text-gray-500 underline py-2">
                        {{ t('giveUp') }} ‚ò†Ô∏è
                    </button>
                </div>
            </div>

            <div v-else-if="gameState === 'punish'" class="flex-1 flex flex-col justify-center items-center p-6" key="punish">
                <div class="w-full bg-gray-900 text-white rounded-[32px] shadow-2xl p-8 flex flex-col relative overflow-hidden text-center animate-shake border border-gray-700">
                    <div class="absolute top-0 left-0 w-full h-3 hazard-stripe"></div>
                    <div class="absolute bottom-0 left-0 w-full h-3 hazard-stripe"></div>
                    <div class="my-8">
                        <div class="text-6xl mb-4">‚ò†Ô∏è</div>
                        <h2 class="text-2xl font-bold font-serif mb-2 text-red-500">PUNISHMENT</h2>
                        <h3 class="text-xl md:text-2xl font-bold leading-relaxed">
                            {{ displayContent(currentPunishment) }}
                        </h3>
                    </div>
                </div>
                <button @click="resolvePunishment" class="mt-8 w-full py-4 bg-gray-800 text-white rounded-2xl font-bold border border-gray-600 active:scale-95 transition">
                    {{ t('accept') }}
                </button>
            </div>
        </transition>

    </div>
    <canvas id="confetti" class="absolute inset-0 pointer-events-none z-[100]"></canvas>

</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    // --- ÂÆåÊï¥È°åÂ∫´ (ÈõôË™û) ---
    const DB = {
        light: [
            { text: { zh: "Â¶ÇÊûúÈÄôËº©Â≠êÂè™ËÉΩÂêÉ‰∏ÄÁ®ÆÈ£üÁâ©Ôºå‰Ω†ÊúÉÈÅ∏‰ªÄÈ∫ºÔºü", en: "If you could only eat one food for the rest of your life, what would it be?" }, type: "question" },
            { text: { zh: "‰Ω†Ë¶∫ÂæóËá™Â∑±ÊúÄÂÉèÂì™‰∏ÄÁ®ÆÂãïÁâ©Ôºü", en: "What animal do you think you are most like?" }, type: "question" },
            { text: { zh: "ÊâãÊ©üË£°Âì™‰∏ÄÁ®Æ App ‰Ω†ÁµïÂ∞çÈõ¢‰∏çÈñãÔºü", en: "Which app on your phone can you absolutely not live without?" }, type: "question" },
            { text: { zh: "Â¶ÇÊûúÊàëÂÄëÂèØ‰ª•‰∫§ÊèõË∫´È´î‰∏ÄÂ§©Ôºå‰Ω†ÊúÄÊÉ≥Áî®ÊàëÁöÑË∫´È´îÂÅö‰ªÄÈ∫ºÔºü", en: "If we could switch bodies for a day, what would you want to do with mine?" }, type: "question" },
            { text: { zh: "‰Ω†Â∞èÊôÇÂÄôÁöÑÂ§¢ÊÉ≥ËÅ∑Ê•≠ÊòØ‰ªÄÈ∫ºÔºü", en: "What was your dream job when you were a child?" }, type: "question" },
            { text: { zh: "Â¶ÇÊûú‰∏≠‰∫Ü‰∏ÄÂÑÑÊ®ÇÈÄèÔºå‰Ω†Á¨¨‰∏Ä‰ª∂ÊúÉË≤∑ÁöÑÊù±Ë•øÊòØ‰ªÄÈ∫ºÔºü", en: "If you won 100 million in the lottery, what is the first thing you would buy?" }, type: "question" },
            { text: { zh: "‰Ω†ÊúÄÂ•áÊÄ™ÁöÑ‰∏ÄÂÄãÂ∞èÁøíÊÖ£ÊàñÊÄ™ÁôñÊòØ‰ªÄÈ∫ºÔºü", en: "What is your weirdest habit or quirk?" }, type: "question" },
            { text: { zh: "Â¶ÇÊûú‰Ω†ÂèØ‰ª•ÊìÅÊúâ‰∏ÄÁ®ÆË∂ÖËÉΩÂäõÔºå‰Ω†ÊÉ≥Ë¶Å‰ªÄÈ∫ºÔºü", en: "If you could have one superpower, what would it be?" }, type: "question" },
            { text: { zh: "Â¶ÇÊûú‰∏ñÁïåÊú´Êó•‰æÜ‰∫ÜÔºå‰Ω†Âè™ËÉΩÂ∏∂‰∏âÊ®£Êù±Ë•øÈÄÉË∑ëÔºå‰Ω†ÊúÉÂ∏∂‰ªÄÈ∫ºÔºü", en: "If the apocalypse came and you could only take three things, what would they be?" }, type: "question" },
            { text: { zh: "‰Ω†Ê¥óÊæ°ÁöÑÊôÇÂÄôÊúÉÂî±Ê≠åÂóéÔºüÂ¶ÇÊûúÊúÉÔºåÈÄöÂ∏∏Âî±‰ªÄÈ∫ºÊ≠åÔºü", en: "Do you sing in the shower? If so, what do you usually sing?" }, type: "question" },
            { text: { zh: "‰Ω†ÊúÄÂñúÊ≠°ÁöÑÂ≠£ÁØÄÊòØÂì™‰∏ÄÂÄãÔºü", en: "What is your favorite season?" }, type: "question" },
            { text: { zh: "‰Ω†ÊØîËºÉÂñúÊ≠°Ë≤ìÈÇÑÊòØÁãóÔºüÁÇ∫‰ªÄÈ∫ºÔºü", en: "Do you prefer cats or dogs? Why?" }, type: "question" },
            { text: { zh: "‰Ω†ÂøÉÊÉÖ‰∏çÂ•ΩÁöÑÊôÇÂÄôÔºåÈÄöÂ∏∏ÊúÉÊÉ≥ÂêÉ‰ªÄÈ∫ºÔºü", en: "What do you usually want to eat when you are in a bad mood?" }, type: "question" },
            { text: { zh: "High FiveÔºöÂíåÂ∞çÊñπ‰æÜ‰∏ÄÂÄãÊúÄÊúâÈªòÂ•ëÁöÑÊìäÊéå„ÄÇ", en: "High Five: Give each other your best high five." }, type: "action" },
            { text: { zh: "ÊâÆÈÜúËá™ÊãçÔºöÁî®Â∞çÊñπÁöÑÊâãÊ©üÊãç‰∏ÄÂºµËá™Â∑±ÊúÄÈÜúÁöÑÈ¨ºËáâÁÖß„ÄÇ", en: "Ugly Selfie: Take the ugliest selfie possible using your partner's phone." }, type: "action" },
            { text: { zh: "Â¶ÇÊûú‰Ω†ËÉΩËÆäÊàêÂç°ÈÄö‰∫∫Áâ©‰∏ÄÂ§©Ôºå‰Ω†ÊÉ≥ËÆäÊàêË™∞Ôºü", en: "If you could be a cartoon character for a day, who would it be?" }, type: "question" },
           { text: { zh: "Â¶ÇÊûúËÉΩÊôÇÈñìÊóÖË°åÔºå‰Ω†ÊÉ≥ÂéªÊú™‰æÜÈÇÑÊòØÈÅéÂéªÔºü", en: "Time travel: future or past?" }, type: "question" },
            { text: { zh: "‰Ω†ÊúÄË®éÂé≠ÁöÑÂÆ∂ÂãôÊòØ‰ªÄÈ∫ºÔºüÈ°òÊÑèÁÇ∫ÊàëÂÅöÂóéÔºü", en: "Worst chore? Would you do it for me?" }, type: "question" },
            { text: { zh: "ÊâãÊåáÈÅäÊà≤ÔºöÊØîË≥ΩË™∞ÁöÑÊâãÊåáÊØîËºÉÈï∑„ÄÇ", en: "Finger length contest." }, type: "action" },
            { text: { zh: "ÂÅáË£ùÈôåÁîü‰∫∫ÔºöÁî® pickup line Êê≠Ë®ïÂ∞çÊñπ„ÄÇ", en: "Pretend to be strangers: use a pickup line." }, type: "action" },
            { text: { zh: "Âπ∏ÈÅãÊäΩÁçéÔºöÈñâÁúºÈö®Ê©üÊë∏Â∞çÊñπËáâ‰∏ä‰∏ÄÂÄãÈÉ®‰ΩçÔºåË™áÂÆÉ„ÄÇ", en: "Lucky draw: touch a random face part and compliment it." }, type: "action" }
   ],

        medium: [
            { text: { zh: "ÊàëÂÄëÁ¨¨‰∏ÄÊ¨°Á¥ÑÊúÉÊôÇÔºå‰Ω†ÂøÉË£°Âú®ÊÉ≥‰ªÄÈ∫ºÔºü", en: "What were you thinking during our first date?" }, type: "question" },
            { text: { zh: "‰Ω†Ë¶∫ÂæóÊàëÂÅöÈÅéÊúÄË≤ºÂøÉÁöÑ‰∏ÄÂÄãÂ∞èËàâÂãïÊòØ‰ªÄÈ∫ºÔºü", en: "What is the sweetest little thing I've ever done for you?" }, type: "question" },
            { text: { zh: "Â¶ÇÊûúË¶ÅÁµ¶ÊàëÂÄëÁöÑÈóú‰øÇÈÅ∏‰∏ÄÈ¶ñ‰∏ªÈ°åÊõ≤ÔºåÊúÉÊòØÂì™‰∏ÄÈ¶ñÔºü", en: "If you had to pick a theme song for our relationship, what would it be?" }, type: "question" },
            { text: { zh: "‰Ω†Ë¶∫ÂæóÊàëË∫´‰∏äÊúÄÊÄßÊÑüÁöÑÈÉ®‰ΩçÊòØÂì™Ë£°Ôºü", en: "Which part of my body do you think is the sexiest?" }, type: "question" },
            { text: { zh: "ÊàëÂÄëÁõ∏ËôïÂà∞ÁèæÂú®Ôºå‰Ω†Ë¶∫ÂæóÊúÄÊêûÁ¨ëÊàñÂ∞∑Â∞¨ÁöÑÂõûÊÜ∂ÊòØ‰ªÄÈ∫ºÔºü", en: "What is the funniest or most embarrassing memory we have together?" }, type: "question" },
            { text: { zh: "‰Ω†Ë¶∫ÂæóÊàëÊúÄÈúÄË¶ÅË¢´ÈºìÂãµÊàñÊîØÊåÅÁöÑÂú∞ÊñπÊòØ‰ªÄÈ∫ºÔºü", en: "Where do you think I need encouragement or support the most?" }, type: "question" },
            { text: { zh: "‰Ω†Á¨¨‰∏ÄÊ¨°Ë¶ãÂà∞ÊàëÁöÑÊôÇÂÄôÔºåÂ∞çÊàëÁöÑÁ¨¨‰∏ÄÂç∞Ë±°ÊòØ‰ªÄÈ∫ºÔºü", en: "What was your first impression of me when we first met?" }, type: "question" },
            { text: { zh: "ÊàëÂÄëÁõ∏ËôïÁöÑÈÅéÁ®ã‰∏≠ÔºåÂì™‰∏ÄÂÄãÁû¨ÈñìËÆì‰Ω†Ë¶∫Âæó„ÄåÂ∞±ÊòØÈÄôÂÄã‰∫∫‰∫Ü„ÄçÔºü", en: "At what moment did you realize 'this is the one'?" }, type: "question" },
            { text: { zh: "‰Ω†ÊúÄÂñúÊ≠°ÊàëÂÄë‰∏ÄËµ∑ÂéªÈÅéÁöÑÂì™ÂÄãÂú∞ÊñπÔºü", en: "What is your favorite place we've visited together?" }, type: "question" },
            { text: { zh: "‰Ω†Ë¶∫ÂæóÊàëÂÄëÂÖ©ÂÄã‰∫∫ÂÄãÊÄß‰∏äÊúÄÂ§ßÁöÑ‰∫íË£úÊòØ‰ªÄÈ∫ºÔºü", en: "What is the biggest way our personalities complement each other?" }, type: "question" },
            { text: { zh: "ÈºªÂ∞ñÁ£®Ëπ≠ÔºöÁî®‰Ω†ÁöÑÈºªÂ≠êÁ£®Ëπ≠Â∞çÊñπÁöÑÈºªÂ≠ê 10 ÁßíÈêò„ÄÇ", en: "Nose Rub: Rub your nose against your partner's nose for 10 seconds." }, type: "action", time: 10 },
            { text: { zh: "Â∞àÂ±¨ÊåâÊë©ÔºöÂπ´Â∞çÊñπÊåâÊë©ËÇ©ËÜÄÊàñÊâãÊéå 1 ÂàÜÈêò„ÄÇ", en: "Massage: Massage your partner's shoulders or hands for 1 minute." }, type: "action", time: 60 },
            { text: { zh: "ËÄ≥ÈÇä‰ΩéË™ûÔºöÂú®Â∞çÊñπËÄ≥ÈÇäÁî®Ê∞£Èü≥Ë™™‰∏ÄÂè•„ÄåÊàëÊÑõ‰Ω†„Äç„ÄÇ", en: "Whisper: Whisper 'I love you' in your partner's ear." }, type: "action" },
            { text: { zh: "Âú®ÊàëÁîüÁóÖÊôÇÔºå‰Ω†ÊúÄÊÉ≥ÁÇ∫ÊàëÂÅö‰ªÄÈ∫ºÔºü", en: "What would you do if I was sick?" }, type: "question" },
            { text: { zh: "ÊèèËø∞ÊàëÂÄëÁêÜÊÉ≥ÁöÑÈÄ±Êú´Á¥ÑÊúÉ„ÄÇ", en: "Describe our perfect weekend date." }, type: "question" }
 ],
        deep: [
            { text: { zh: "‰Ω†Ë¶∫Âæó„ÄåÂπ∏Á¶èÁöÑÂÆ∂Â∫≠„ÄçÊúÄÈáçË¶ÅÁöÑ‰∏âÂÄãÂÖÉÁ¥†ÊòØ‰ªÄÈ∫ºÔºü", en: "What are the three most important elements of a happy family?" }, type: "question" },
            { text: { zh: "ÂÅáÂ¶ÇÊàëÂÄëÂêµÊû∂‰∫ÜÔºå‰Ω†Â∏åÊúõÊàëÊÄéÈ∫ºÊâìÁ†¥ÂÉµÂ±ÄÔºü", en: "If we have a fight, how would you like me to break the ice?" }, type: "question" },
            { text: { zh: "‰Ω†Ë¶∫ÂæóËá™Â∑±Âú®ÊÑõÊÉÖ‰∏≠ÊúÄÂ§ßÁöÑÂº±ÈªûÊòØ‰ªÄÈ∫ºÔºü", en: "What do you think is your biggest weakness in love?" }, type: "question" },
            { text: { zh: "Â¶ÇÊûúÈÄôÊòØÊàëÁîüÂëΩÁöÑÊúÄÂæå‰∏ÄÂ§©Ôºå‰Ω†ÊÉ≥Â∞çÊàëË™™‰ªÄÈ∫ºÔºü", en: "If this were the last day of my life, what would you want to say to me?" }, type: "question" },
            { text: { zh: "‰Ω†Â∞çÊàëÂÄëÊú™‰æÜ 5 Âπ¥ÁöÑÁîüÊ¥ªÊúâ‰ªÄÈ∫ºÊÉ≥ÂÉèÔºü", en: "How do you envision our lives in 5 years?" }, type: "question" },
            { text: { zh: "Âú®ÊàëÂÄëÁöÑÈóú‰øÇ‰∏≠Ôºå‰Ω†ÊúÄÂÆ≥ÊÄïÂ§±ÂéªÁöÑÊòØ‰ªÄÈ∫ºÔºü", en: "What are you most afraid of losing in our relationship?" }, type: "question" },
            { text: { zh: "‰Ω†Ë¶∫ÂæóÊàëÂÄë‰πãÈñìÁõÆÂâçÊúÄÂ§ßÁöÑÊåëÊà∞ÊòØ‰ªÄÈ∫ºÔºü", en: "What do you think is the biggest challenge between us right now?" }, type: "question" },
            { text: { zh: "‰Ω†Â∞çÊñº„ÄåÂ©öÂßª„ÄçÁöÑÁúüÂØ¶ÁúãÊ≥ïÊòØ‰ªÄÈ∫ºÔºü", en: "What is your honest view on marriage?" }, type: "question" },
            { text: { zh: "Â¶ÇÊûúÊàëÂÄëÂú®ÈáëÈå¢ËßÄ‰∏äÁôºÁîüÂö¥ÈáçÂàÜÊ≠ßÔºå‰Ω†Ë¶∫ÂæóË©≤ÊÄéÈ∫ºËß£Ê±∫Ôºü", en: "If we have a serious disagreement about money, how should we resolve it?" }, type: "question" },
            { text: { zh: "‰Ω†‰∫∫Áîü‰∏≠ÊúÄÂ§ßÁöÑÊÅêÊáºÊòØ‰ªÄÈ∫ºÔºü", en: "What is your biggest fear in life?" }, type: "question" },
            { text: { zh: "ÂøÉË∑≥ÈÄ£ÁµêÔºöÊääÊâãÊîæÂú®Â∞çÊñπÂ∑¶ËÉ∏Âè£ÔºåÂÆâÈùúÊÑüÂèóÂøÉË∑≥ 30 Áßí„ÄÇ", en: "Heartbeat: Place your hand on your partner's chest and feel their heartbeat for 30s." }, type: "action", time: 30 },
            { text: { zh: "ÁÑ°ËÅ≤ÂëäÁôΩÔºö‰∏çËÉΩË™™Ë©±ÔºåÁî®ËÇ¢È´îË™ûË®ÄË°®ÈÅî„ÄåÊàëÊÑõ‰Ω†„Äç„ÄÇ", en: "Silent Love: Without speaking, use body language to express 'I love you'." }, type: "action" }
        ],
        truth: [
            { text: { zh: "ÁèæÂú®ÂøÉË£°ÊúâÊ≤íÊúâÂ∞çÊàë‰∏çÊªøÁöÑ‰∏Ä‰ª∂‰∫ãÔºüÊòØ‰ªÄÈ∫ºÔºü", en: "Is there anything you are currently dissatisfied with about me? What is it?" }, subType: "truth" },
            { text: { zh: "Ë™™Âá∫‰Ω†Ââç‰ªªÂÅöÈÅéÊúÄËÆì‰Ω†Âèó‰∏ç‰∫ÜÁöÑ‰∏Ä‰ª∂‰∫ã„ÄÇ", en: "What is the most unbearable thing your ex ever did?" }, subType: "truth" },
            { text: { zh: "‰Ω†ÊúâÊ≤íÊúâÂÅ∑ÂÅ∑ÁúãÈÅéÊàëÁöÑÊâãÊ©üÔºü", en: "Have you ever secretly looked through my phone?" }, subType: "truth" },
            { text: { zh: "ÊàëÂÄëÁ¨¨‰∏ÄÊ¨°Êé•ÂêªÊôÇÔºå‰Ω†ÁúüÂØ¶ÁöÑÊÑüË¶∫ÊòØ‰ªÄÈ∫ºÔºü", en: "What did you honestly feel during our first kiss?" }, subType: "truth" },
            { text: { zh: "‰Ω†Ë¶∫ÂæóÊàëÂÄëÈÄôÊÆµÈóú‰øÇ‰∏≠ÔºåË™∞‰ªòÂá∫ÊØîËºÉÂ§öÔºü", en: "Who do you think contributes more in this relationship?" }, subType: "truth" },
            { text: { zh: "‰Ω†ÊúâÊ≤íÊúâÂ∞çÊàëË™™ÈÅéË¨äÔºüÂì™ÊÄïÊòØÂñÑÊÑèÁöÑÔºü", en: "Have you ever lied to me? Even a white lie?" }, subType: "truth" },
            { text: { zh: "Â¶ÇÊûúÊàëÂÄëÂàÜÊâã‰∫ÜÔºå‰Ω†ÊúÉÊÉ≥ÊåΩÂõûÂóéÔºü", en: "If we broke up, would you try to get me back?" }, subType: "truth" },
            { text: { zh: "‰Ω†Ë¶∫ÂæóÊàëÂì™‰∏ÄÂÄãÊúãÂèãÊúÄÊúâÂê∏ÂºïÂäõÔºü", en: "Which of my friends do you find most attractive?" }, subType: "truth" },
            { text: { zh: "ÊúÄËøë‰∏ÄÊ¨°ËÆì‰Ω†Áî¢ÁîüÊÄßÂπªÊÉ≥ÁöÑÂ∞çË±°ÊòØË™∞ÔºàÈô§‰∫ÜÊàëÔºâÔºü", en: "Who was the last person you had a sexual fantasy about (besides me)?" }, subType: "truth" },
            { text: { zh: "‰Ω†ÊúÄÂèó‰∏ç‰∫ÜÊàëÁöÑ‰∏ÄÂÄãÁîüÊ¥ªÁøíÊÖ£ÊòØ‰ªÄÈ∫ºÔºü", en: "What is the one habit of mine you can't stand the most?" }, subType: "truth" }
        ],
        dare: [
            { text: { zh: "Ê®°‰ªøÊàëÁîüÊ∞£ÊôÇÂÄôÁöÑÊ®£Â≠êÔºåÁõ¥Âà∞ÊàëÊªøÊÑèÁÇ∫Ê≠¢„ÄÇ", en: "Imitate how I look when I'm angry until I'm satisfied." }, subType: "dare" },
            { text: { zh: "ÂÖ¨‰∏ªÊä±ÊàëÔºàÊàñËÉåÊàëÔºâÊ∑±Ëπ≤ 5 ‰∏ã„ÄÇ", en: "Princess carry (or piggyback) me and do 5 squats." }, subType: "dare", time: 30 },
            { text: { zh: "ËÆìÊàëÊü•Áúã‰Ω†ÁöÑÊâãÊ©üÁõ∏Á∞ø 1 ÂàÜÈêò„ÄÇ", en: "Let me look through your phone gallery for 1 minute." }, subType: "dare", time: 60 },
            { text: { zh: "Áî®Âò¥Â∑¥Âí¨‰ΩèÊàëÁöÑËÄ≥ÊúµÔºåÂ†ÖÊåÅ 10 Áßí„ÄÇ", en: "Gently bite my ear and hold for 10 seconds." }, subType: "dare", time: 10 },
            { text: { zh: "ÁèæÂú®ÊâìÈõªË©±Áµ¶‰∏Ä‰ΩçÊúãÂèãÔºåÂ§ßËÅ≤Ë™™„ÄåÊàëÂ•ΩÊÉ≥‰Ω†„ÄçÔºåÁÑ∂ÂæåÊéõÊñ∑„ÄÇ", en: "Call a friend, scream 'I miss you so much', and hang up." }, subType: "dare" },
            { text: { zh: "ÂéªÂÜ∞ÁÆ±ÊãøÂÜ∞Â°äÔºåÂê´Âú®Âò¥Ë£°ÁÑ∂ÂæåË¶™ÂêªÊàëÁöÑËÑñÂ≠ê„ÄÇ", en: "Get an ice cube, hold it in your mouth, and kiss my neck." }, subType: "dare" },
            { text: { zh: "Ë∑≥‰∏ÄÊÆµÊÄßÊÑüÁöÑËàûËπàÔºåÊåÅÁ∫å 30 Áßí„ÄÇ", en: "Do a sexy dance for 30 seconds." }, subType: "dare", time: 30 },
            { text: { zh: "ÂíåÊàëÂ∞çË¶ñ 1 ÂàÜÈêòÔºåË™∞ÂÖàÁ¨ëË™∞Â∞±Ëº∏„ÄÇ", en: "Stare contest for 1 minute. First to laugh loses." }, subType: "dare", time: 60 },
            { text: { zh: "ËÑ´Êéâ‰∏Ä‰ª∂Ë∫´‰∏äÁöÑË°£Áâ©ÔºàÈ£æÂìÅ‰∏çÁÆóÔºâ„ÄÇ", en: "Remove one item of clothing (accessories don't count)." }, subType: "dare" },
            { text: { zh: "Áî®Â±ÅËÇ°ÂØ´Â≠óÔºåÂØ´Âá∫ÊàëÁöÑÂêçÂ≠ó„ÄÇ", en: "Write my name using your butt." }, subType: "dare" }
        ],
        punishments: [
            { zh: "ÁΩ∞Âñù‰∏ÄÊùØÊ∞¥", en: "Drink a glass of water" },
            { zh: "‰ºèÂú∞Êå∫Ë∫´ 10 ‰∏ã", en: "Do 10 push-ups" },
            { zh: "Ë¢´Â∞çÊñπÂΩàÈ°çÈ†≠‰∏Ä‰∏ã", en: "Get flicked on the forehead" },
            { zh: "Ë≤†Ë≤¨Ë≤∑‰∏ãÊ¨°ÁöÑÂÆµÂ§ú", en: "Buy the next late-night snack" },
            { zh: "Âπ´Â∞çÊñπÂêπÈ†≠È´Æ", en: "Dry your partner's hair next time" },
            { zh: "‰∫§Âá∫ÊâãÊ©üÊ™¢Êü• 3 ÂàÜÈêò", en: "Hand over phone for 3 min inspection" },
            { zh: "‰∏çËÉΩË™™Ë©± 3 ÂàÜÈêò", en: "No speaking for 3 minutes" },
            { zh: "Âπ´Â∞çÊñπÊåâÊë© 5 ÂàÜÈêò", en: "Massage partner for 5 minutes" }
        ]
    };

    const I18N = {
        'en': {
            subtitle: "Give love a moment.",
            modeLight: "Ice Breaker", descLight: "Fun & easy",
            modeMedium: "Heating Up", descMedium: "Memories & sweetness",
            modeDeep: "Soul Talk", descDeep: "Deep connection",
            modeTod: "Truth or Dare", descTod: "Spicy challenges",
            turn: "Turn", next: "Next Card", finish: "Finish", giveUp: "Can't do it? Punishment",
            chooseDestiny: "Choose Your Destiny", truth: "Truth", dare: "Dare", back: "Back to Menu",
            accept: "Accept & Next", question: "Question"
        },
        'zh-TW': {
            subtitle: "Áµ¶ÊÑõ‰∏ÄÈªûÊôÇÈñìÔºåËÆìÂøÉÊõ¥Èù†Ëøë„ÄÇ",
            modeLight: "ËºïÈ¨ÜÁ†¥ÂÜ∞", descLight: "Ë∂£Âë≥Ë©±È°å & Á∞°ÂñÆ‰∫íÂãï",
            modeMedium: "Âä†Ê∫´ÊôÇÂàª", descMedium: "ÁîúËúúÂõûÊÜ∂ & Ë¶™ÂØÜÊé•Ëß∏",
            modeDeep: "ÈùàÈ≠ÇÊ∑±Ëôï", descDeep: "ÂÉπÂÄºËßÄ & ÂøÉÈùàÈÄ£Áµê",
            modeTod: "ÁúüÂøÉË©±Â§ßÂÜíÈö™", descTod: "Ë™†ÂØ¶ÂõûÁ≠îÊàñÊé•ÂèóÊåëÊà∞",
            turn: "Ëº™Âà∞", next: "‰∏ã‰∏ÄÂºµ", finish: "ÂÆåÊàêÈÅäÊà≤", giveUp: "ÂÅö‰∏çÂà∞ÔºüÊé•ÂèóÊá≤ÁΩ∞",
            chooseDestiny: "ÈÅ∏Êìá‰Ω†ÁöÑÂëΩÈÅã", truth: "ÁúüÂøÉË©±", dare: "Â§ßÂÜíÈö™", back: "Âõû‰∏ªÈÅ∏ÂñÆ",
            accept: "Êé•ÂèóÊá≤ÁΩ∞‰∏¶‰∏ã‰∏ÄÂ±Ä", question: "ÂïèÈ°å"
        }
    };

    createApp({
        setup() {
            // State
            const gameState = ref('intro');
            const currentCategory = ref('light');
            const currentLang = ref('zh-TW');
            const isDark = ref(false);
            const showSettings = ref(false);
            const deck = ref([]);
            const currentIndex = ref(0);
            const isRevealed = ref(false);
            const turn = ref(0);
            const progress = ref({ light: false, medium: false, deep: false, tod: false });
            
            const currentPunishment = ref("");

            const timerRunning = ref(false);
            const timerCount = ref(0);
            let timerInterval = null;

            // Computed
            const t = (key) => I18N[currentLang.value][key] || key;
            const players = computed(() => currentLang.value === 'en' ? ["You", "Partner"] : ["‰Ω†", "‰º¥‰æ∂"]);
            const currentPlayer = computed(() => players.value[turn.value]);
            
            const currentCard = computed(() => {
                if (deck.value.length === 0) return { text: "" };
                return deck.value[currentIndex.value];
            });

            // --- Êñ∞Â¢ûÔºöÈ°ØÁ§∫ÈÇèËºØËôïÁêÜÂáΩÂºè ---
            const displayContent = (content) => {
                if (!content) return '';
                // Â¶ÇÊûúÊòØÂ≠ó‰∏≤ÔºàÁõ∏ÂÆπËàäÊ†ºÂºèÔºâÁõ¥Êé•ÂõûÂÇ≥
                if (typeof content === 'string') return content;
                // Â¶ÇÊûúÊòØÁâ©‰ª∂ÔºåÊ†πÊìöË™ûË®ÄË®≠ÂÆöÂõûÂÇ≥
                return content[currentLang.value] || content['zh'];
            };
            
            const isLastCard = computed(() => currentIndex.value >= deck.value.length - 1);

            const cardBorderClass = computed(() => {
                if(currentCategory.value === 'tod') {
                    return currentCard.value.subType === 'truth' ? 'border-l-4 border-blue-400' : 'border-l-4 border-orange-400';
                }
                return currentCard.value.type === 'action' ? 'border-l-4 border-yellow-400' : 'border-l-4 border-brand-light';
            });

            const modes = {
                light: { titleKey: 'modeLight', descKey: 'descLight', emoji: '‚òÅÔ∏è', borderColor: 'border-blue-300', iconBg: 'bg-blue-100' },
                medium: { titleKey: 'modeMedium', descKey: 'descMedium', emoji: '‚ú®', borderColor: 'border-pink-300', iconBg: 'bg-pink-100' },
                deep: { titleKey: 'modeDeep', descKey: 'descDeep', emoji: 'üåô', borderColor: 'border-purple-300', iconBg: 'bg-purple-100' },
                tod: { titleKey: 'modeTod', descKey: 'descTod', emoji: 'üî•', borderColor: 'border-orange-300', iconBg: 'bg-orange-100' }
            };

            const toggleDarkMode = () => { isDark.value = !isDark.value; document.documentElement.classList.toggle('dark'); };
            const vibration = (pattern = 10) => { if(navigator.vibrate) navigator.vibrate(pattern); };

            const startGame = (category) => {
                currentCategory.value = category;
                turn.value = 0;
                resetTimer();

                if (category === 'tod') {
                    deck.value = []; 
                    gameState.value = 'selection';
                } else {
                    // ÈáçË¶Å‰øÆÊ≠£ÔºöÁ¢∫‰øùÂä†‰∏ä ID ËÆì Vue Ê≠£Á¢∫Ê∏≤Êüì
                    deck.value = [...DB[category]]
                        .sort(() => Math.random() - 0.5)
                        .map((c, i) => ({ ...c, id: i }));
                    
                    currentIndex.value = 0;
                    isRevealed.value = false;
                    gameState.value = 'game';
                }
            };

            const pickTodCard = (type) => {
                vibration(20);
                const pool = DB[type];
                const card = pool[Math.floor(Math.random() * pool.length)];
                deck.value = [{ ...card, id: Date.now() }];
                currentIndex.value = 0;
                isRevealed.value = false;
                gameState.value = 'game';
            };

            const revealCard = () => {
                if (!isRevealed.value) {
                    vibration(30);
                    isRevealed.value = true;
                }
            };

            const nextCard = () => {
                vibration(10);
                resetTimer();
                if (currentCategory.value === 'tod') {
                    turn.value = turn.value === 0 ? 1 : 0;
                    gameState.value = 'selection';
                } else {
                    if (isLastCard.value) {
                        progress.value[currentCategory.value] = true;
                        launchConfetti();
                        resetGame();
                    } else {
                        isRevealed.value = false;
                        setTimeout(() => {
                            currentIndex.value++;
                            turn.value = turn.value === 0 ? 1 : 0;
                        }, 300);
                    }
                }
            };

            const triggerPunishment = () => {
                vibration([50, 50, 200]);
                const list = DB.punishments;
                currentPunishment.value = list[Math.floor(Math.random() * list.length)];
                gameState.value = 'punish';
            };

            const resolvePunishment = () => {
                nextCard(); 
            };

            const resetGame = () => {
                gameState.value = 'intro';
                resetTimer();
            };

            const resetTimer = () => {
                clearInterval(timerInterval);
                timerRunning.value = false;
                timerCount.value = 0;
            };

            const toggleTimer = () => {
                vibration(20);
                if (timerRunning.value) {
                    resetTimer();
                } else {
                    timerCount.value = currentCard.value.time;
                    timerRunning.value = true;
                    timerInterval = setInterval(() => {
                        if (timerCount.value > 0) timerCount.value--;
                        else { vibration([100,50,100]); resetTimer(); }
                    }, 1000);
                }
            };

            const sendReaction = () => {
                vibration([10, 30]);
                confetti({ particleCount: 30, spread: 50, origin: { y: 0.8 }, colors: ['#ff0000', '#ffccd5'] });
            };

            const launchConfetti = () => {
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            };

            return {
                gameState, modes, startGame, resetGame,
                currentCategory, currentCard, currentPlayer,
                isRevealed, isLastCard,
                nextCard, revealCard,
                showSettings, isDark, toggleDarkMode, currentLang, t, progress,
                pickTodCard, triggerPunishment, currentPunishment, resolvePunishment,
                sendReaction, toggleTimer, timerRunning, timerCount, cardBorderClass,
                displayContent 
            };
        }
    }).mount('#app');
</script>

</body>
</html>